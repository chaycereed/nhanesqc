# nhanesqc

Welcome to **nhanesqc** — a lightweight R toolkit that performs **quick,
structured quality control** on NHANES datasets (CSV, XPT, or data
frames).

`nhanesqc` is built for public-health, epidemiology, biomedical, and
data-science workflows that rely on NHANES and need fast, reproducible
quality control before deeper analysis.

------------------------------------------------------------------------

## Features

- **One-command QC** for NHANES files:

  ``` r

  nhanes_qc("DEMO_H.xpt")
  nhanes_qc("DEMO_H.csv")
  nhanes_qc(nhanesA::nhanes("DEMO_H"))
  ```

- **Automatic format detection**

  - `.csv` → readr::read_csv()
  - `.xpt` → haven::read_xpt()
  - data frames → used directly

- **Clean column names** (snake_case) and tibble output

- **Variable summaries**, including:

  - column type
  - number of unique values
  - missingness counts
  - basic structure

- **NHANES special missing-code detection**, covering:

  - 7 / 9
  - 77 / 99
  - 777 / 999
  - 7777 / 9999 *(no automatic recoding; detection only)*

- **Custom S3 methods**:

  - print() — preview
  - summary() — full text output
  - plot() — missingness and special-code visualizations

- **Plot options**:

  - plot(qc) → missingness
  - plot(qc, type = “special”) → NHANES-style special codes

- Minimal dependencies; fast enough for large NHANES tables.

------------------------------------------------------------------------

## Installation

``` r

remotes::install_github("chaycereed/nhanesqc")
```

Then:

``` r

library(nhanesqc)
```

------------------------------------------------------------------------

## Usage

### 1. Quick QC on a CSV file

``` r

qc <- nhanes_qc("DEMO_H.csv")
qc
```

### 2. Run QC directly on an XPT file

``` r

qc <- nhanes_qc("DEMO_H.xpt")
qc
```

### 3. Run QC on a data frame

``` r

library(nhanesA)
demo_h <- nhanesA::nhanes("DEMO_H")

qc <- nhanes_qc(demo_h)
qc
```

``` r
NHANES QC result

File:   <data.frame input>
Rows:   10175
Cols:   47

Variable summary (preview):
# A tibble: 6 × 5
  variable class   n_missing prop_missing n_unique
  <chr>    <chr>       <int>        <dbl>    <int>
1 seqn     numeric         0        0        10175
2 sddsrvyr factor          0        0            1
3 ridstatr factor          0        0            2
4 riagendr factor          0        0            2
5 ridageyr numeric         0        0           81
6 ridagemn numeric      9502        0.934       26
... (41 more variables)

Missingness / special codes (preview):
# A tibble: 4 × 6
  variable  n_na prop_na n_special prop_special special_codes_found
  <chr>    <int>   <dbl>     <int>        <dbl> <chr>              
1 ridageyr     0   0           484      0.0476  7, 77, 9           
2 ridagemn  9502   0.934        76      0.00747 7, 9               
3 ridexagm  5962   0.586       110      0.0108  7, 77, 9, 99       
4 dmdhrage     0   0            46      0.00452 77                 

Use:
  qc$variables    # full variable summary
  qc$missingness  # full missingness / special-code summary
```

### 3. Summary of QC

``` r

summary(qc)
```

``` r
Summary of NHANES QC result

Dimensions:
  Rows:   10175
  Cols:   47

Overall missingness (across all cells):
  Total missing values: 82092
  Proportion missing:   0.172

Variables with missing values:      26
Variables with special codes found: 4

Top variables by proportion missing (up to 10):
# A tibble: 10 × 3
   variable  n_na prop_na
   <chr>    <int>   <dbl>
 1 dmqadfc   9632   0.947
 2 ridagemn  9502   0.934
 3 ridexprg  8866   0.871
 4 dmdyrsus  8267   0.812
 5 dmdeduc3  7372   0.725
 6 ridexagm  5962   0.586
 7 dmdhsedu  4833   0.475
 8 dmdeduc2  4406   0.433
 9 dmdmartl  4406   0.433
10 dmqmiliz  3914   0.385

Variables with NHANES-style special codes (up to 10):
# A tibble: 4 × 4
  variable n_special prop_special special_codes_found
  <chr>        <int>        <dbl> <chr>              
1 ridageyr       484      0.0476  7, 77, 9           
2 ridexagm       110      0.0108  7, 77, 9, 99       
3 ridagemn        76      0.00747 7, 9               
4 dmdhrage        46      0.00452 77       
```

### 4. Plot missingness

``` r

plot(qc)                     # missingness
```

![](reference/figures/missingness_demo.png)

### 5. Plot special codes

``` r

plot(qc, type = "special")   # NHANES special codes
```

![](reference/figures/specialcodes_demo.png)

------------------------------------------------------------------------

## Why Detection Only?

NHANES variables use *different* special-code patterns, and blind
recoding can incorrectly mark real values (e.g., age = 77) as missing.

`nhanesqc` focuses on **safe detection**, not automatic recoding.

A future version will include codebook-aware recoding.

------------------------------------------------------------------------

## License

MIT License. See `LICENSE` for details

# Package index

## All functions

- [`nhanes_missingness_summary()`](nhanes_missingness_summary.md) :
  Detect NHANES-style special missing codes (detection only)
- [`nhanes_qc()`](nhanes_qc.md) : Quick QC for a NHANES-style dataset
  (CSV, XPT, or data frame)
- [`nhanes_variable_summary()`](nhanes_variable_summary.md) : Summarize
  variables in a NHANES-style data frame
- [`plot(`*`<nhanes_qc_result>`*`)`](plot.nhanes_qc_result.md) : Plot
  method for nhanes_qc_result objects
- [`print(`*`<nhanes_qc_result>`*`)`](print.nhanes_qc_result.md) : Print
  method for nhanes_qc_result objects
- [`read_nhanes_csv()`](read_nhanes_csv.md) : Read a NHANES-style CSV
  file
- [`read_nhanes_xpt()`](read_nhanes_xpt.md) : Read a NHANES-style XPT
  (SAS transport) file
- [`summary(`*`<nhanes_qc_result>`*`)`](summary.nhanes_qc_result.md) :
  Summary method for nhanes_qc_result objects

# Articles

### All vignettes

- [nhanesqc: Introduction](nhanesqc-intro.md):
